# So far I did not succeed in compiling Inkscape on CentOS 6.
# Please help me make this work on CentOS 6.
# http://wiki.inkscape.org/wiki/index.php/CompilingRHEL
# is totally outdated.

###########################################

yum -y install gcc ImageMagick-devel ImageMagick intltool gc gc-devel lcms lcms-devel gsl gsl-devel libxml2-devel libxslt-devel boost-devel popt-devel poppler-devel
# ImageMagick-c++-devel ImageMagick-c++

URL=$(wget -q "https://inkscape.org/cs/download/source/" -O - | grep tar.bz2 | head -n 1 | cut -d '"' -f 2)
wget -c "$URL"

# Or the latest version from git- 6 MB
# wget https://github.com/inkscape/inkscape/archive/master.zip
# unzip master.zip
# cd inkscape-master/inkscape-launchpad/

# Workaround for:
# Requested 'cairo >= 1.10' but version of cairo is 1.8.8
cd /etc/yum.repos.d/
wget http://ftp5.gwdg.de/pub/opensuse/repositories/home:/Kakumba/RedHat_RHEL-6/home:Kakumba.repo
yum -y install cairo-devel libcairo2
cd -

# Workaround for:
# Requested 'cairomm-1.0 >= 1.9.8' but version of cairomm is 1.8.0
wget -c http://cairographics.org/releases/cairomm-1.9.8.tar.gz
tar xf cairomm-1.9.8.tar.gz
cd cairomm-1.9.8
./configure --prefix=/usr --enable-static --disable-shared
make
sudo make install
cd ..

# Workaround for:
# When compiling glibmm,
# extra_defs_gen/generate_defs_gio.cc:25:34: fatal error: 
# gio/gsettingsbackend.h: No such file or directory
rpm -ivh ftp://fr2.rpmfind.net/linux/sourceforge/f/fu/fuduntu-el/el6/current/UNSTABLE/RPMS/glibc-common-2.15-60.el6.x86_64.rpm ftp://fr2.rpmfind.net/linux/sourceforge/f/fu/fuduntu-el/el6/current/UNSTABLE/RPMS/glibc-2.15-60.el6.x86_64.rpm ftp://fr2.rpmfind.net/linux/sourceforge/f/fu/fuduntu-el/el6/current/UNSTABLE/RPMS/glib2-devel-2.35.8-1.el6.x86_64.rpm ftp://fr2.rpmfind.net/linux/sourceforge/f/fu/fuduntu-el/el6/current/UNSTABLE/RPMS/glib2-2.35.8-1.el6.x86_64.rpm --replacefiles

# Workaround for:
# Requested 'glibmm-2.4 >= 2.28' but version of glibmm is 2.22.1
wget -c http://ftp.gnome.org/pub/gnome/sources/glibmm/2.28/glibmm-2.28.0.tar.bz2
tar xf glibmm-2.28.0.tar.bz2
cd glibmm-2.28.0
./configure --prefix=/usr --enable-static --disable-shared
make
sudo make install
cd ..

# Workaround for:
# Requested 'cairomm-1.0 >= 1.9.8' but version of cairomm is 1.8.0
# Requested 'glibmm-2.4 >= 2.28' but version of glibmm is 2.22.1
# This is because .pc files have been installed in /usr/lib rather than /usr/lib64
export PKG_CONFIG_PATH=/usr/lib/pkgconfig/

# Workaround for:
# configure: error: *** A compiler with support for C++11 language features is required.
. /opt/rh/devtoolset-2/enable 

# Workaround for:
# error: 'size_t' does not name a type
# when compiling gtkmm
wget -c http://ftp.gnome.org/pub/GNOME/sources/libsigc++/2.2/libsigc++-2.2.9.tar.bz2
tar xf libsigc++-2.2.9.tar.bz2
cd libsigc++-2.2.9
./configure --prefix=/usr --enable-static --disable-shared
make
sudo make install
cd ..

wget -c http://ftp.gnome.org/pub/GNOME/sources/gtkmm/2.18/gtkmm-2.18.0.tar.bz2
tar xf gtkmm-2.18.0.tar.bz2
cd gtkmm-2.18.0
./configure --prefix=/usr --enable-static --disable-shared
make
sudo make install
cd ..

# Workaround for:
# error: expected '=', ',', ';', 'asm' or '__attribute__' before 'char'
# when compiling Inkscape
# This is because GLib has deprecated the macro G_CONST_RETURN
# https://forums.gentoo.org/viewtopic-p-6829424.html#6829424
sed -i -e 's|-DG_DISABLE_DEPRECATED||g' configure
sed -i -e 's|-DGTK_DISABLE_DEPRECATED||g' configure

tar xf inkscape*.tar.bz2
cd inkscape-*

./autogen.sh
./configure --prefix=/AppImage --enable-binreloc
make

sudo make install
