yum -y install alsa-lib-devel pulseaudio-libs-devel qt-devel libgcrypt-devel libX11-devel libxcb-devel freetype-devel libjpeg-turbo-devel libpng-devel libxml2-devel zlib lua libnotify-devel libva-devel gnome-vfs2-devel librsvg2-devel libudev-devel avahi-devel libmtp-devel patch libtool pkgconfig fribidi-devel gettext-devel

  # Compile and install yasm 1.2.0 (or newer)
  wget -c http://www.tortall.net/projects/yasm/releases/yasm-1.2.0.tar.gz
  tar -xzf yasm-1.2.0.tar.gz
  cd yasm-1.2.0
  ./configure --prefix=/usr
  make
  make install
  cd ..

APP=VLC
rm -rf ./$APP/$APP.AppDir
mkdir -p ./$APP/$APP.AppDir
cd ./$APP

if [ -z "$NO_LIBS" ] ; then
  #ragel
  cd /usr/local/src
  wget http://www.colm.net/files/ragel/ragel-6.9.tar.gz
  tar -xvf ragel-6.9.tar.gz
  cd /usr/local/src/ragel-6.9
  ./configure && make && make install

  #update automake to 2.69
  cd /usr/local/src
  wget http://ftp.gnu.org/gnu/autoconf/autoconf-2.69.tar.gz
  tar xvfvz autoconf-2.69.tar.gz
  cd /usr/local/src/autoconf-2.69
  ./configure --prefix=/usr
  make && make install

  #update libtool to 2.4.6
  cd /usr/local/src
  wget http://ftpmirror.gnu.org/libtool/libtool-2.4.6.tar.gz
  tar xvfvz libtool-2.4.6.tar.gz
  cd /usr/local/src/libtool-2.4.6
  ./configure --prefix=/usr
  make && make install
fi


cd /$APP/

LATEST=$(wget -q "http://download.videolan.org/pub/videolan/vlc/last/" -O - | grep "tar.xz<" | head -n 1 | cut -d '"' -f 2)
wget -c "http://download.videolan.org/pub/videolan/vlc/last/$LATEST"
tar xf vlc-2.2.2.tar.xz

cd vlc-*/

if [ -z "$NO_LIBS" ] ; then
  cd contrib
  # rm -rf ./x86_64-redhat-linux/ || true
  mkdir native
  cd native
  ../bootstrap
  # Disable bluray because it depends on java which is large (can enable it later again)
  sed -i -e 's|PKGS_DISABLE := |PKGS_DISABLE := bluray caca|g' config.mak 
  make # errors out, hence doing:
  # Workaround for:
  # ass_shaper.c:31:19: error: hb-ft.h: No such file or directory
  cp -rf ./harfbuzz/src/*.h /VLC/vlc-2.2.2/contrib/x86_64-redhat-linux/include/harfbuzz/
  make
  cd ../../
fi

# autoreconf: running: /usr/bin/autoconf --include=/VLC/vlc-2.2.2/contrib/x86_64-redhat-linux/share/aclocal --force
# configure.ac:23: error: possibly undefined macro: AM_GNU_GETTEXT_VERSION
#       If this token and others are legitimate, please use m4_pattern_allow.
#       See the Autoconf documentation.
# configure.ac:133: error: possibly undefined macro: AM_ICONV
# autoreconf: /usr/bin/autoconf failed with exit status: 1
# make: *** [.cddb] Error 1
