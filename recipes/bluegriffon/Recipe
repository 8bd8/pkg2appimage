# sudo apt-get update
sudo apt-get -y install git mercurial

# https://developer.mozilla.org/en-US/docs/Mozilla/Developer_guide/Build_Instructions/Linux_Prerequisites
# Install all system prerequisites
wget -O bootstrap.py https://hg.mozilla.org/mozilla-central/raw-file/default/python/mozboot/bin/bootstrap.py 

python bootstrap.py --application-choice=browser --no-interactive

# Only continue if we get:
# "Your system should be ready to build Firefox for Desktop!"

# Get mozilla-central from Mozilla through Mercurial
REV=$(wget -q https://github.com/therealglazou/bluegriffon/raw/bg2/config/mozilla_central_revision.txt -O -)
hg clone http://hg.mozilla.org/mozilla-central bluegriffon-source -r $REV
# git clone https://github.com/mozilla/gecko-dev bluegriffon-source --depth 1 

# Get BlueGriffon's tree through
cd bluegriffon-source
git clone -b bg2 --single-branch https://github.com/therealglazou/bluegriffon --depth 1

patch -p 1 < bluegriffon/config/content.patch

# Workaround for:
# client.mk:199: .mozconfig.mk: No such file or directory
# Still needed (FIXME)

# build the bluegriffon-ng or the bg2 branch
./mach build

